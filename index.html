<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WLD Balance Checker - API Ready</title>

<!-- Tailwind CSS from CDN -->
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

<!-- Font Awesome from CDN -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">

</head>
<body class="bg-gray-100 min-h-screen">
    <div id="loading" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-6 rounded-lg">
            <i class="fas fa-spinner fa-spin text-2xl text-blue-500"></i>
            <span class="ml-3">Checking balances...</span>
        </div>
    </div>

    <div id="app" class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-3xl font-bold text-center mb-2 text-gray-800">
                <i class="fas fa-coins text-yellow-500"></i> WLD Balance Checker
            </h1>
            <p class="text-center text-gray-600 mb-8">Real-time World Chain token balance monitoring</p>

            <!-- Add Wallet Section -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">
                    <i class="fas fa-plus-circle text-green-500"></i> Add New Wallet
                </h2>
                <div class="grid md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nickname</label>
                        <input type="text" id="nickname" placeholder="e.g., John" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Wallet Address</label>
                        <input type="text" id="address" placeholder="0x..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="flex items-end">
                        <button onclick="addWallet()" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-md transition">
                            <i class="fas fa-plus"></i> Add Wallet
                        </button>
                    </div>
                </div>
            </div>

            <!-- Wallets List -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">
                        <i class="fas fa-wallet text-blue-500"></i> Monitored Wallets
                    </h2>
                    <button onclick="checkAllBalances()" class="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-md transition">
                        <i class="fas fa-sync"></i> Check All Balances
                    </button>
                </div>
                <div id="walletsList" class="space-y-3">
                    <p class="text-gray-500 text-center">No wallets added yet</p>
                </div>
            </div>

            <!-- Results Section -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">
                    <i class="fas fa-chart-line text-purple-500"></i> Balance Results
                </h2>
                <div id="results" class="bg-gray-50 p-4 rounded-md min-h-20">
                    <p class="text-gray-500 text-center">Click "Check All Balances" to see results</p>
                </div>
                <div class="mt-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">API Endpoint URL:</label>
                    <div class="flex">
                        <input type="text" id="apiUrl" readonly class="flex-1 px-3 py-2 bg-gray-50 border border-gray-300 rounded-l-md text-sm">
                        <button onclick="copyUrl()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-r-md transition">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">Use this URL for HTTP requests from automation apps</p>
                </div>
            </div>
        </div>
    </div>

<script>
const WORLD_CHAIN_ID = 480;
const WLD_TOKEN_CONTRACT = "0x2cfc85d8e48f8eab294be644d9e25c3030863003";
const RPC_ENDPOINTS = [
    "https://worldchain-mainnet.g.alchemy.com/public",
    "https://480.rpc.thirdweb.com"
];

let wallets = [];

function isApiRequest() {
    const userAgent = navigator.userAgent.toLowerCase();
    return userAgent.includes('okhttp') || 
           userAgent.includes('curl') || 
           userAgent.includes('postman') ||
           userAgent.includes('automation') ||
           (window.location.search.includes('api=true'));
}

window.onload = function() {
    updateApiUrl();
    loadWallets();
    if (isApiRequest()) {
        document.body.style.display = 'none';
        checkAllBalancesApi();
        return;
    }
    renderWallets();
};

function loadWallets() {
    const saved = localStorage.getItem('wldWallets');
    if (saved) {
        wallets = JSON.parse(saved);
    } else {
        wallets = [];
        saveWallets();
    }
}

function saveWallets() {
    localStorage.setItem('wldWallets', JSON.stringify(wallets));
}

function addWallet() {
    const nickname = document.getElementById('nickname').value.trim();
    const address = document.getElementById('address').value.trim();
    if (!nickname || !address) {
        alert('Please enter both nickname and address');
        return;
    }
    if (!address.match(/^0x[a-fA-F0-9]{40}$/)) {
        alert('Please enter a valid Ethereum address');
        return;
    }
    if (wallets.some(w => w.address.toLowerCase() === address.toLowerCase())) {
        alert('This address is already being monitored');
        return;
    }
    wallets.push({nickname, address});
    saveWallets();
    renderWallets();
    document.getElementById('nickname').value = '';
    document.getElementById('address').value = '';
}

function removeWallet(index) {
    if (confirm('Are you sure you want to remove this wallet?')) {
        wallets.splice(index, 1);
        saveWallets();
        renderWallets();
    }
}

function renderWallets() {
    const container = document.getElementById('walletsList');
    if (wallets.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-center">No wallets added yet</p>';
        return;
    }
    container.innerHTML = wallets.map((wallet, index) => `
        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-md">
            <div>
                <span class="font-semibold text-gray-800">${wallet.nickname}</span>
                <span class="text-sm text-gray-600 ml-2">${wallet.address.slice(0, 8)}...${wallet.address.slice(-6)}</span>
            </div>
            <button onclick="removeWallet(${index})" class="text-red-500 hover:text-red-700 p-2">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    `).join('');
}

function updateApiUrl() {
    document.getElementById('apiUrl').value = window.location.href + '?api=true';
}

function copyUrl() {
    const urlInput = document.getElementById('apiUrl');
    urlInput.select();
    document.execCommand('copy');
}

async function makeRpcCall(endpoint, method, params) {
    const response = await fetch(endpoint, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            jsonrpc: '2.0',
            id: 1,
            method: method,
            params: params
        })
    });
    const data = await response.json();
    if (data.error) throw new Error(data.error.message);
    return data.result;
}

async function getTokenBalance(address) {
    const balanceOfSignature = '0x70a08231';
    const paddedAddress = address.slice(2).padStart(64, '0');
    const callData = balanceOfSignature + paddedAddress;
    for (const endpoint of RPC_ENDPOINTS) {
        try {
            const result = await makeRpcCall(endpoint, 'eth_call', [
                { to: WLD_TOKEN_CONTRACT, data: callData },
                'latest'
            ]);
            const balanceWei = BigInt(result);
            const balance = Number(balanceWei) / Math.pow(10, 18);
            return balance;
        } catch {}
    }
    throw new Error('All RPC endpoints failed');
}

async function checkAllBalances() {
    if (wallets.length === 0) {
        document.getElementById('results').innerHTML = '<p class="text-red-500 text-center">No wallets to check</p>';
        return;
    }
    document.getElementById('loading').classList.remove('hidden');
    const results = [];
    try {
        for (const wallet of wallets) {
            try {
                const balance = await getTokenBalance(wallet.address);
                const formattedBalance = balance % 1 === 0 ? Math.floor(balance) : balance.toFixed(2);
                results.push(`${wallet.nickname} ${formattedBalance} WLD token`);
            } catch {
                results.push(`${wallet.nickname} Error checking balance`);
            }
        }
        document.getElementById('results').innerHTML = results.map(r => `<div class="p-2 bg-white rounded border">${r}</div>`).join('');
    } finally {
        document.getElementById('loading').classList.add('hidden');
    }
}

async function checkAllBalancesApi() {
    if (wallets.length === 0) {
        document.write('No wallets configured');
        return;
    }
    const results = [];
    for (const wallet of wallets) {
        try {
            const balance = await getTokenBalance(wallet.address);
            const formattedBalance = balance % 1 === 0 ? Math.floor(balance) : balance.toFixed(2);
            results.push(`${wallet.nickname} ${formattedBalance} WLD token`);
        } catch {
            results.push(`${wallet.nickname} Error`);
        }
    }
    document.write(results.join('\n'));
}
</script>

</body>
</html>
