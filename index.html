<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WLD Balance Checker</title>
  <!-- Base64 Favicon -->
  <link rel="icon" type="image/png" href="data:image/png;base64,INSERT_BASE64_LOGO_HERE"/>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9fafb;
      margin: 0;
      padding: 20px;
      color: #222;
    }
    .card {
      background: #fff;
      padding: 20px;
      margin: 0 auto 20px auto;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      max-width: 600px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .card img {
      height: 40px;
      margin-right: 15px;
    }
    .wallets {
      max-width: 600px;
      margin: 0 auto;
    }
    .wallet {
      background: #fff;
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 10px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
    }
    .wallet span.address {
      font-family: monospace;
      color: #444;
    }
    button {
      background: #4CAF50;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      color: white;
      cursor: pointer;
      font-size: 13px;
    }
    button:hover {
      background: #43a047;
    }
    .actions {
      margin-top: 20px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="card">
    <!-- Base64 logo -->
    <img src="data:image/png;base64,INSERT_BASE64_LOGO_HERE" alt="Logo">
    <div>
      <div id="price">WLD Price: ‚Ç±0.00</div>
      <div id="claim">First Claim Value: ‚Ç±0.00</div>
    </div>
  </div>

  <div class="wallets" id="wallets"></div>

  <div class="actions">
    <input type="text" id="nickname" placeholder="Nickname">
    <input type="text" id="address" placeholder="Wallet Address" size="42">
    <button onclick="addWallet()">Add Wallet</button>
    <br><br>
    <button onclick="checkAllBalances()">Check All Balances</button>
  </div>

  <script>
    const WLD_TOKEN_CONTRACT = "0x2cfc85d8e48f8eab294be644d9e25c3030863003";
    const RPC_ENDPOINTS = [
      "https://rpc.ankr.com/eth",
      "https://eth.llamarpc.com"
    ];
    const PRICE_API = "https://api.coingecko.com/api/v3/simple/price?ids=worldcoin-wld&vs_currencies=php";

    let wallets = JSON.parse(localStorage.getItem("wallets") || "[]");
    let lastBalances = {};
    let lastPrice = localStorage.getItem("wld_price_php") || null;

    // format with commas
    function formatPHP(value) {
      return "‚Ç±" + Number(value).toLocaleString("en-PH", {minimumFractionDigits: 2, maximumFractionDigits: 2});
    }

    // Notifications
    function notify(title, body) {
      if (Notification.permission === "granted") {
        new Notification(title, {body: body});
      } else {
        document.title = "üîî " + title;
      }
    }

    // Add wallet
    function addWallet() {
      const nickname = document.getElementById("nickname").value.trim();
      const address = document.getElementById("address").value.trim();
      if (!nickname || !address) return;
      wallets.push({nickname, address});
      localStorage.setItem("wallets", JSON.stringify(wallets));
      renderWallets();
    }

    // Remove wallet
    function removeWallet(i) {
      wallets.splice(i, 1);
      localStorage.setItem("wallets", JSON.stringify(wallets));
      renderWallets();
    }

    // Copy address
    function copyAddress(addr) {
      navigator.clipboard.writeText(addr);
      alert("Copied: " + addr);
    }

    // RPC Call
    async function makeRpcCall(endpoint, method, params) {
      const response = await fetch(endpoint, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({jsonrpc:"2.0",id:1,method,params})
      });
      const data = await response.json();
      return data.result;
    }

    // Get token balance
    async function getTokenBalance(address) {
      const balanceOfSignature = "0x70a08231";
      const paddedAddress = address.slice(2).padStart(64, "0");
      const callData = balanceOfSignature + paddedAddress;
      for (const endpoint of RPC_ENDPOINTS) {
        try {
          const result = await makeRpcCall(endpoint, "eth_call", [{to: WLD_TOKEN_CONTRACT, data: callData}, "latest"]);
          return Number(BigInt(result) / BigInt(1e16)) / 100; // 2 decimals
        } catch {}
      }
      return 0;
    }

    async function fetchPrice() {
      try {
        const res = await fetch(PRICE_API);
        const json = await res.json();
        const price = json["worldcoin-wld"]["php"];
        lastPrice = price;
        localStorage.setItem("wld_price_php", price);
        return price;
      } catch {
        return lastPrice || 0;
      }
    }

    async function checkAllBalances() {
      const price = await fetchPrice();
      document.getElementById("price").innerText = "WLD Price: " + formatPHP(price);
      document.getElementById("claim").innerText = "First Claim Value: " + formatPHP(price * 25);

      for (let wallet of wallets) {
        const bal = await getTokenBalance(wallet.address);
        const old = lastBalances[wallet.address] || 0;
        lastBalances[wallet.address] = bal;

        const phpValue = bal * price;
        document.getElementById("bal-" + wallet.address).innerText = bal.toFixed(2) + " WLD (" + formatPHP(phpValue) + ")";

        if (old && bal !== old) {
          if (bal > old) {
            notify("+" + (bal-old).toFixed(2) + " WLD deposited to " + wallet.nickname,
                   "New balance: " + bal.toFixed(2) + " WLD");
          } else {
            notify("-" + (old-bal).toFixed(2) + " WLD withdrawn from " + wallet.nickname,
                   "New balance: " + bal.toFixed(2) + " WLD");
          }
        }
      }
    }

    function renderWallets() {
      const div = document.getElementById("wallets");
      div.innerHTML = "";
      wallets.forEach((w,i) => {
        div.innerHTML += `
          <div class="wallet">
            <div>
              <b>${w.nickname}</b> 
              <span class="address">${w.address.slice(0,6)}...${w.address.slice(-6)}</span>
              <button onclick="copyAddress('${w.address}')">üìã</button>
            </div>
            <div id="bal-${w.address}">Loading...</div>
            <button onclick="removeWallet(${i})">‚ùå</button>
          </div>`;
      });
    }

    // Init
    renderWallets();
    if (Notification.permission !== "granted") {
      Notification.requestPermission();
    }
    checkAllBalances();
    setInterval(checkAllBalances, 60000);
  </script>
</body>
</html>
